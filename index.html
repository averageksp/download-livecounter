<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AverageKSP Download Stats</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2rem;
    }
    #results {
      font-size: 1.2em;
      margin-bottom: 2rem;
    }
    svg text {
      font-size: 14px;
    }
    textarea {
      width: 100%;
      height: 250px;
      margin-top: 20px;
      font-family: monospace;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <h1>Download Stats for averageksp Mods</h1>

  <div id="results">Loading download counts...</div>
  <svg id="chart" width="600" height="200"></svg>

  <button onclick="generateSVGCode()">Get SVG</button>

  <textarea id="svg-output" placeholder="SVG code will appear here..." readonly></textarea>

  <script>
    const mods = ["KerbalChecklists", "WasdMainMenu", "RP-1-Checklists"];
    const jsonURL = "https://raw.githubusercontent.com/KSP-CKAN/CKAN-meta/6ce43b260868a4bea1bd081b039b7b66c13d06cc/download_counts.json";

    let svgInnerContent = "";

    async function fetchDownloads() {
      try {
        const res = await fetch(jsonURL);
        const data = await res.json();

        const chart = document.getElementById("chart");
        const results = document.getElementById("results");

        let total = 0;
        let barWidth = 500 / mods.length;
        let maxVal = 0;

        const downloads = mods.map(mod => {
          const count = data[mod] || 0;
          if (count > maxVal) maxVal = count;
          total += count;
          return { name: mod, count };
        });

        results.innerHTML = `
          <strong>Individual Downloads:</strong><br>
          ${downloads.map(d => `${d.name}: ${d.count.toLocaleString()}`).join("<br>")}<br><br>
          <strong>Total:</strong> ${total.toLocaleString()}
        `;

        // Draw bars
        chart.setAttribute("height", 180 + mods.length * 20); // adjust if needed
        chart.innerHTML = "";
        svgInnerContent = "";

        downloads.forEach((mod, index) => {
          const barHeight = (mod.count / maxVal) * 100;
          const x = index * (barWidth + 20) + 50;
          const y = 150 - barHeight;

          svgInnerContent += `
            <rect x="${x}" y="${y}" width="${barWidth}" height="${barHeight}" fill="#4CAF50" />
            <text x="${x + barWidth / 2}" y="165" text-anchor="middle">${mod.name}</text>
            <text x="${x + barWidth / 2}" y="${y - 5}" text-anchor="middle">${mod.count}</text>
          `;

          chart.innerHTML = svgInnerContent;
        });

      } catch (err) {
        console.error("Failed to fetch download data:", err);
        document.getElementById("results").textContent = "Failed to load data.";
      }
    }

    function generateSVGCode() {
      const svgCode = `
<svg width="600" height="250" xmlns="http://www.w3.org/2000/svg">
  ${svgInnerContent}
</svg>`.trim();

      document.getElementById("svg-output").value = svgCode;
    }

    fetchDownloads();
  </script>
</body>
</html>

</body>
</html>
