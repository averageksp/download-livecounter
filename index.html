<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AverageKSP Mod Downloads</title>
  <style>
    body {
      font-family: 'Orbitron', sans-serif;
      background: #0b0f14;
      color: #c0ffc0;
      text-align: center;
      padding: 2rem;
    }

    h1 {
      font-size: 2em;
      color: #88ff88;
    }

    .mod-list {
      margin: 1rem auto;
      max-width: 600px;
    }

    svg text {
      font-size: 14px;
      fill: #ffffff;
    }

    button {
      background-color: #1b2e1b;
      border: 1px solid #4CAF50;
      color: #c0ffc0;
      padding: 10px 20px;
      font-size: 1em;
      margin-top: 20px;
      cursor: pointer;
    }

    button:hover {
      background-color: #2e4e2e;
    }

    #embed-code {
      background: #101820;
      color: #aaffaa;
      padding: 10px;
      font-family: monospace;
      width: 100%;
      max-width: 600px;
      margin: 20px auto;
      border: 1px solid #4CAF50;
    }
  </style>

  <link href="https://fonts.googleapis.com/css2?family=Orbitron&display=swap" rel="stylesheet">
</head>
<body>
  <h1>üõ∞Ô∏è averageksp Mod Downloads</h1>

  <div id="results">Loading download data from CKAN...</div>
  <svg id="chart" width="600" height="200"></svg>

  <button onclick="generateEmbedCode()">üì¶ Get Embed Markdown</button>
  <div id="embed-code">Loading embed code...</div>

  <script>
    const mods = ["KerbalChecklists", "WasdMainMenu", "RP-1-Checklists"];
    const jsonURL = "https://raw.githubusercontent.com/KSP-CKAN/CKAN-meta/6ce43b260868a4bea1bd081b039b7b66c13d06cc/download_counts.json";
    const chart = document.getElementById("chart");
    const results = document.getElementById("results");
    const embedCode = document.getElementById("embed-code");

    let svgInnerContent = "";

    async function fetchDownloads() {
      try {
        const res = await fetch(jsonURL);
        const data = await res.json();

        let total = 0;
        let barWidth = 500 / mods.length;
        let maxVal = 0;

        const downloads = mods.map(mod => {
          const count = data[mod] || 0;
          if (count > maxVal) maxVal = count;
          total += count;
          return { name: mod, count };
        });

        results.innerHTML = `
          <strong>MODS:</strong><br>
          ${downloads.map(d => `${d.name}: ${d.count.toLocaleString()}`).join("<br>")}<br><br>
          <strong>TOTAL:</strong> ${total.toLocaleString()}
        `;

        chart.setAttribute("height", 180);
        chart.innerHTML = "";
        svgInnerContent = "";

        downloads.forEach((mod, index) => {
          const barHeight = (mod.count / maxVal) * 100;
          const x = index * (barWidth + 20) + 50;
          const y = 150 - barHeight;

          svgInnerContent += `
            <rect x="${x}" y="${y}" width="${barWidth}" height="${barHeight}" fill="#4CAF50" />
            <text x="${x + barWidth / 2}" y="165" text-anchor="middle">${mod.name}</text>
            <text x="${x + barWidth / 2}" y="${y - 5}" text-anchor="middle">${mod.count}</text>
          `;
        });

        chart.innerHTML = svgInnerContent;
        
        generateEmbedCode();

      } catch (err) {
        console.error("Error fetching data:", err);
        results.innerHTML = "‚ö†Ô∏è Failed to load data.";
      }
    }

    function generateEmbedCode() {
      const lines = mods.map(mod => {
        return `![${mod}](https://averageksp.github.io/download-livecounter/?mod=${mod}.svg)`;
      });

      embedCode.textContent = lines.join("\n");
    }

    fetchDownloads();
  </script>
</body>
</html>

</body>
</html>
